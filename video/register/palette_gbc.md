# 🎨 カラーパレット(CGBモードのみ)

CGBでは64バイト(0x40バイト)のパレット用のメモリなるものが、BG用とOBJ用に合計2つ存在しますが、これはアドレスと紐づけられておらず、通常のメモリアクセスではアクセスできません。

そこで利用されるのがこれから説明されるレジスタたちです。

BG/OBJパレットインデックスは、パレットメモリのアドレスを指定します。(バンク番号に近い)

BG/OBJパレットデータは、パレットインデックスで指定したパレットメモリの内容がマッピングされます。このレジスタを読み書きすることでパレットメモリにアクセスすることができます。

## FF68 - BCPS/BGPI - BGパレットインデックス

このレジスタは、CGBにおいてBGパレットメモリのアドレスを指定するために利用します。

上で述べたようにBGパレットメモリは全部で64バイトで、1つ8バイトのパレットデータが8つ格納されています。(BGP0~BGP7)

```
0   BGP0
        - 色番号0の色データ(2バイト, 後述)
        - 色番号1
        - 色番号2
        - 色番号3
8   BGP1
        - 色番号0 
        - 色番号1
        - 色番号2
        - 色番号3
16  BGP2
        - 色番号0 
        - 色番号1
        - 色番号2
        - 色番号3
    ...
56  BGP7
        - 色番号0 
        - 色番号1
        - 色番号2
        - 色番号3
```

```
Bit 7     オートインクリメント  (0=無効, 1=書き込み後にインクリメント発生)
Bit 5-0   インデックス (00-3F)
```

BGパレットメモリのインデックスを指定した後は、後述のレジスタFF69を介して、BGパレットデータを読み書きすることができます。

オートインクリメント(bit7)がセットされている場合、FF69への書き込みごとにインデックスが自動的にインクリメントされます。FF69からの読み出し時にはオートインクリメントの効果はないので、その場合は手動でインデックスをインクリメントする必要があります。レンダリング中にFF69に書き込んでも、オートインクリメントは発生します。

## FF69 - BCPD/BGPD - BGパレットデータ

このレジスタは，レジスタ`$FF68`を介してアドレス指定されたCGBの背景パレットメモリへのデータの読み書きを可能にします。

各色は2バイトで定義されます。bit0-7が1バイト目、bit8-15が2バイト目です。

```
  Bit 0-4:   赤   (00 - 1F)
  Bit 5-9:   緑   (00 - 1F)
  Bit 10-14: 青   (00 - 1F)
```

## FF6A - OCPS/OBPI - OBJパレットインデックス

BGパレットと内容は同じです。

## FF6B - OCPD/OBPD - OBJパレットデータ

BGパレットと内容は同じです。

ただし色0は透明を表すことには注意してください。

